# ğŸ—„ï¸ DoctorLink ë°ì´í„°ë² ì´ìŠ¤ ì„¤ê³„

## ê°œìš”

DoctorLinkëŠ” Microsoft SQL Server 2019ë¥¼ ì‚¬ìš©í•˜ì—¬ ë°ì´í„°ë¥¼ ê´€ë¦¬í•©ë‹ˆë‹¤.

### ë°ì´í„°ë² ì´ìŠ¤ ì •ë³´

- **DBMS**: Microsoft SQL Server 2019 Express
- **ë°ì´í„°ë² ì´ìŠ¤ëª…**: DoctorLink
- **ë¬¸ì ì¸ì½”ë”©**: UTF-8 (NVARCHAR ì‚¬ìš©)
- **ì •ê·œí™” ìˆ˜ì¤€**: 3NF (ì œ3ì •ê·œí˜•)
- **í…Œì´ë¸” ìˆ˜**: 8ê°œ
- **ì €ì¥ í”„ë¡œì‹œì € ìˆ˜**: 3ê°œ

---

## ERD (Entity Relationship Diagram)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     Users       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ UserID (PK)     â”‚â—„â”€â”€â”€â”€â”€â”€â”
â”‚ Email           â”‚       â”‚
â”‚ Password        â”‚       â”‚
â”‚ Name            â”‚       â”‚
â”‚ Phone           â”‚       â”‚
â”‚ Role            â”‚       â”‚
â”‚ BirthDate       â”‚       â”‚
â”‚ Gender          â”‚       â”‚
â”‚ CreatedAt       â”‚       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
        â”‚                 â”‚
        â”‚ 1               â”‚ 1
        â”‚                 â”‚
        â”‚ *               â”‚ *
â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Appointments    â”‚  â”‚  MedicalRecords  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ AppointmentID(PK)â”‚  â”‚ RecordID (PK)    â”‚
â”‚ PatientID (FK)   â”‚  â”‚ PatientID (FK)   â”‚
â”‚ DoctorID (FK)    â”‚â”€â”€â”¤ DoctorID (FK)    â”‚
â”‚ AppointmentDate  â”‚  â”‚ AppointmentID(FK)â”‚
â”‚ AppointmentTime  â”‚  â”‚ Diagnosis        â”‚
â”‚ Status           â”‚  â”‚ Treatment        â”‚
â”‚ Reason           â”‚  â”‚ Prescription     â”‚
â”‚ CreatedAt        â”‚  â”‚ Notes            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ RecordDate       â”‚
        â”‚             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚ *
        â”‚
        â”‚ 1
â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     Doctors      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ DoctorID (PK)    â”‚â—„â”€â”€â”€â”€â”€â”€â”
â”‚ UserID (FK)      â”‚       â”‚
â”‚ HospitalID (FK)  â”‚â”€â”€â”€â”   â”‚
â”‚ Specialty        â”‚   â”‚   â”‚
â”‚ LicenseNumber    â”‚   â”‚   â”‚
â”‚ Experience       â”‚   â”‚   â”‚
â”‚ Bio              â”‚   â”‚   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
                       â”‚   â”‚ *
                       â”‚   â”‚
                    1  â”‚   â”‚ 1
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚ â”Œâ”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Hospitals     â”‚   â”‚ â”‚    Reviews     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ HospitalID (PK)  â”‚â—„â”€â”€â”˜ â”‚ ReviewID (PK)  â”‚
â”‚ Name             â”‚     â”‚ PatientID (FK) â”‚
â”‚ Address          â”‚     â”‚ DoctorID (FK)  â”‚
â”‚ City             â”‚     â”‚ Rating         â”‚
â”‚ Type             â”‚     â”‚ Comment        â”‚
â”‚ Phone            â”‚     â”‚ CreatedAt      â”‚
â”‚ Latitude         â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ Longitude        â”‚
â”‚ Rating           â”‚
â”‚ CreatedAt        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚ 1
        â”‚
        â”‚ *
â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Notifications   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ NotificationID(PK)â”‚
â”‚ UserID (FK)      â”‚
â”‚ Type             â”‚
â”‚ Title            â”‚
â”‚ Message          â”‚
â”‚ IsRead           â”‚
â”‚ CreatedAt        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Inquiries      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ InquiryID (PK)   â”‚
â”‚ UserID (FK)      â”‚
â”‚ Type             â”‚
â”‚ Name             â”‚
â”‚ Email            â”‚
â”‚ Subject          â”‚
â”‚ Message          â”‚
â”‚ Status           â”‚
â”‚ CreatedAt        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## í…Œì´ë¸” ìƒì„¸ ì„¤ê³„

### 1. Users (ì‚¬ìš©ì í…Œì´ë¸”)

ì‚¬ìš©ì ê³„ì • ì •ë³´ë¥¼ ì €ì¥í•©ë‹ˆë‹¤.

| ì»¬ëŸ¼ëª… | ë°ì´í„° íƒ€ì… | NULL | í‚¤ | ê¸°ë³¸ê°’ | ì„¤ëª… |
|--------|------------|------|-----|--------|------|
| UserID | INT | NO | PK | IDENTITY(1,1) | ì‚¬ìš©ì ê³ ìœ  ID |
| Email | NVARCHAR(100) | NO | UNIQUE | - | ì´ë©”ì¼ (ë¡œê·¸ì¸ ID) |
| Password | NVARCHAR(255) | NO | - | - | bcrypt í•´ì‹œ ë¹„ë°€ë²ˆí˜¸ |
| Name | NVARCHAR(50) | NO | - | - | ì´ë¦„ |
| Phone | NVARCHAR(20) | YES | - | - | ì „í™”ë²ˆí˜¸ |
| Role | NVARCHAR(20) | NO | - | 'patient' | ì—­í•  (patient/doctor/admin) |
| BirthDate | DATE | YES | - | - | ìƒë…„ì›”ì¼ |
| Gender | NVARCHAR(10) | YES | - | - | ì„±ë³„ (male/female) |
| Address | NVARCHAR(255) | YES | - | - | ì£¼ì†Œ |
| BloodType | NVARCHAR(5) | YES | - | - | í˜ˆì•¡í˜• (A/B/AB/O) |
| Allergies | NVARCHAR(255) | YES | - | - | ì•Œë ˆë¥´ê¸° (JSON ë°°ì—´) |
| CreatedAt | DATETIME | NO | - | GETDATE() | ê°€ì… ì¼ì‹œ |
| UpdatedAt | DATETIME | YES | - | - | ìˆ˜ì • ì¼ì‹œ |

**ì¸ë±ìŠ¤**:
- PRIMARY KEY: `UserID`
- UNIQUE INDEX: `Email`
- INDEX: `Role`

**ì œì•½ ì¡°ê±´**:
- `Email` í˜•ì‹ ê²€ì¦ (@ í¬í•¨)
- `Role` CHECK ì œì•½: `Role IN ('patient', 'doctor', 'admin')`
- `Password` ìµœì†Œ ê¸¸ì´: 60ì (bcrypt í•´ì‹œ)

**ìƒ˜í”Œ ë°ì´í„°**:
```sql
INSERT INTO Users (Email, Password, Name, Phone, Role, BirthDate, Gender)
VALUES 
  ('patient@test.com', '$2b$10$...', 'í™ê¸¸ë™', '010-1234-5678', 'patient', '1990-01-01', 'male'),
  ('doctor@test.com', '$2b$10$...', 'ê¹€ì˜ì‚¬', '010-9876-5432', 'doctor', '1980-05-15', 'female');
```

---

### 2. Hospitals (ë³‘ì› í…Œì´ë¸”)

ë³‘ì› ì •ë³´ë¥¼ ì €ì¥í•©ë‹ˆë‹¤.

| ì»¬ëŸ¼ëª… | ë°ì´í„° íƒ€ì… | NULL | í‚¤ | ê¸°ë³¸ê°’ | ì„¤ëª… |
|--------|------------|------|-----|--------|------|
| HospitalID | INT | NO | PK | IDENTITY(1,1) | ë³‘ì› ê³ ìœ  ID |
| Name | NVARCHAR(100) | NO | - | - | ë³‘ì›ëª… |
| Address | NVARCHAR(255) | NO | - | - | ì£¼ì†Œ |
| City | NVARCHAR(50) | NO | INDEX | - | ì‹œ/ë„ |
| District | NVARCHAR(50) | YES | - | - | êµ¬/êµ° |
| Type | NVARCHAR(50) | NO | - | - | ë³‘ì› ìœ í˜• (ì¢…í•©ë³‘ì›, ë³‘ì›, ì˜ì› ë“±) |
| Phone | NVARCHAR(20) | NO | - | - | ëŒ€í‘œ ì „í™”ë²ˆí˜¸ |
| Latitude | DECIMAL(10,8) | YES | - | - | ìœ„ë„ (-90 ~ 90) |
| Longitude | DECIMAL(11,8) | YES | - | - | ê²½ë„ (-180 ~ 180) |
| Rating | DECIMAL(3,2) | YES | - | 0.00 | í‰ê·  í‰ì  (0.00~5.00) |
| ReviewCount | INT | NO | - | 0 | ë¦¬ë·° ìˆ˜ |
| Description | NVARCHAR(500) | YES | - | - | ë³‘ì› ì†Œê°œ |
| OpenTime | TIME | YES | - | - | ê°œì› ì‹œê°„ |
| CloseTime | TIME | YES | - | - | íì› ì‹œê°„ |
| CreatedAt | DATETIME | NO | - | GETDATE() | ë“±ë¡ ì¼ì‹œ |

**ì¸ë±ìŠ¤**:
- PRIMARY KEY: `HospitalID`
- INDEX: `City`, `Type`
- COMPOSITE INDEX: `(City, Type)`

**ì œì•½ ì¡°ê±´**:
- `Rating` CHECK: `Rating >= 0 AND Rating <= 5`
- `ReviewCount` CHECK: `ReviewCount >= 0`

---

### 3. Doctors (ì˜ì‚¬ í…Œì´ë¸”)

ì˜ì‚¬ ì •ë³´ë¥¼ ì €ì¥í•©ë‹ˆë‹¤.

| ì»¬ëŸ¼ëª… | ë°ì´í„° íƒ€ì… | NULL | í‚¤ | ê¸°ë³¸ê°’ | ì„¤ëª… |
|--------|------------|------|-----|--------|------|
| DoctorID | INT | NO | PK | IDENTITY(1,1) | ì˜ì‚¬ ê³ ìœ  ID |
| UserID | INT | NO | FK | - | Users.UserID |
| HospitalID | INT | NO | FK | - | Hospitals.HospitalID |
| Specialty | NVARCHAR(50) | NO | - | - | ì „ë¬¸ ë¶„ì•¼ (ë‚´ê³¼, ì™¸ê³¼ ë“±) |
| LicenseNumber | NVARCHAR(50) | NO | UNIQUE | - | ì˜ì‚¬ ë©´í—ˆ ë²ˆí˜¸ |
| Experience | INT | YES | - | - | ê²½ë ¥ (ë…„) |
| Education | NVARCHAR(255) | YES | - | - | í•™ë ¥ |
| Bio | NVARCHAR(500) | YES | - | - | ì†Œê°œ |
| ProfileImage | NVARCHAR(255) | YES | - | - | í”„ë¡œí•„ ì‚¬ì§„ URL |
| CreatedAt | DATETIME | NO | - | GETDATE() | ë“±ë¡ ì¼ì‹œ |

**ì¸ë±ìŠ¤**:
- PRIMARY KEY: `DoctorID`
- UNIQUE INDEX: `UserID`, `LicenseNumber`
- FOREIGN KEY: `UserID` â†’ Users(UserID)
- FOREIGN KEY: `HospitalID` â†’ Hospitals(HospitalID)
- INDEX: `Specialty`, `HospitalID`

---

### 4. Appointments (ì˜ˆì•½ í…Œì´ë¸”)

ì˜ˆì•½ ì •ë³´ë¥¼ ì €ì¥í•©ë‹ˆë‹¤.

| ì»¬ëŸ¼ëª… | ë°ì´í„° íƒ€ì… | NULL | í‚¤ | ê¸°ë³¸ê°’ | ì„¤ëª… |
|--------|------------|------|-----|--------|------|
| AppointmentID | INT | NO | PK | IDENTITY(1,1) | ì˜ˆì•½ ê³ ìœ  ID |
| PatientID | INT | NO | FK | - | Users.UserID (í™˜ì) |
| DoctorID | INT | NO | FK, INDEX | - | Doctors.DoctorID |
| AppointmentDate | DATE | NO | INDEX | - | ì˜ˆì•½ ë‚ ì§œ |
| AppointmentTime | TIME | NO | - | - | ì˜ˆì•½ ì‹œê°„ |
| Status | NVARCHAR(20) | NO | INDEX | 'pending' | ìƒíƒœ (pending/approved/completed/cancelled) |
| Reason | NVARCHAR(255) | YES | - | - | ë°©ë¬¸ ì‚¬ìœ  |
| Notes | NVARCHAR(500) | YES | - | - | ì¶”ê°€ ë©”ëª¨ |
| CreatedAt | DATETIME | NO | - | GETDATE() | ì˜ˆì•½ ìƒì„± ì¼ì‹œ |
| UpdatedAt | DATETIME | YES | - | - | ìˆ˜ì • ì¼ì‹œ |

**ì¸ë±ìŠ¤**:
- PRIMARY KEY: `AppointmentID`
- FOREIGN KEY: `PatientID` â†’ Users(UserID)
- FOREIGN KEY: `DoctorID` â†’ Doctors(DoctorID)
- COMPOSITE INDEX: `(DoctorID, AppointmentDate, AppointmentTime)` (ì¤‘ë³µ ì˜ˆì•½ ë°©ì§€)
- INDEX: `Status`, `PatientID`

**ì œì•½ ì¡°ê±´**:
- `Status` CHECK: `Status IN ('pending', 'approved', 'completed', 'cancelled')`
- UNIQUE: `(DoctorID, AppointmentDate, AppointmentTime)` WHERE Status IN ('pending', 'approved')

---

### 5. MedicalRecords (ì§„ë£Œ ê¸°ë¡ í…Œì´ë¸”)

ì§„ë£Œ ê¸°ë¡ì„ ì €ì¥í•©ë‹ˆë‹¤.

| ì»¬ëŸ¼ëª… | ë°ì´í„° íƒ€ì… | NULL | í‚¤ | ê¸°ë³¸ê°’ | ì„¤ëª… |
|--------|------------|------|-----|--------|------|
| RecordID | INT | NO | PK | IDENTITY(1,1) | ê¸°ë¡ ê³ ìœ  ID |
| PatientID | INT | NO | FK, INDEX | - | Users.UserID (í™˜ì) |
| DoctorID | INT | NO | FK | - | Doctors.DoctorID |
| AppointmentID | INT | YES | FK | - | Appointments.AppointmentID |
| Diagnosis | NVARCHAR(255) | NO | - | - | ì§„ë‹¨ëª… |
| Treatment | NVARCHAR(500) | YES | - | - | ì¹˜ë£Œ ë‚´ìš© |
| Prescription | NVARCHAR(500) | YES | - | - | ì²˜ë°©ì „ |
| Notes | NVARCHAR(1000) | YES | - | - | ì§„ë£Œ ë©”ëª¨ |
| Attachments | NVARCHAR(MAX) | YES | - | - | ì²¨ë¶€íŒŒì¼ (JSON ë°°ì—´) |
| RecordDate | DATE | NO | - | GETDATE() | ì§„ë£Œ ë‚ ì§œ |
| CreatedAt | DATETIME | NO | - | GETDATE() | ê¸°ë¡ ìƒì„± ì¼ì‹œ |

**ì¸ë±ìŠ¤**:
- PRIMARY KEY: `RecordID`
- FOREIGN KEY: `PatientID` â†’ Users(UserID)
- FOREIGN KEY: `DoctorID` â†’ Doctors(DoctorID)
- FOREIGN KEY: `AppointmentID` â†’ Appointments(AppointmentID)
- INDEX: `PatientID`, `RecordDate`

---

### 6. Reviews (ë¦¬ë·° í…Œì´ë¸”)

ë³‘ì› ë° ì˜ì‚¬ ë¦¬ë·°ë¥¼ ì €ì¥í•©ë‹ˆë‹¤.

| ì»¬ëŸ¼ëª… | ë°ì´í„° íƒ€ì… | NULL | í‚¤ | ê¸°ë³¸ê°’ | ì„¤ëª… |
|--------|------------|------|-----|--------|------|
| ReviewID | INT | NO | PK | IDENTITY(1,1) | ë¦¬ë·° ê³ ìœ  ID |
| PatientID | INT | NO | FK | - | Users.UserID (í™˜ì) |
| DoctorID | INT | NO | FK, INDEX | - | Doctors.DoctorID |
| HospitalID | INT | NO | FK, INDEX | - | Hospitals.HospitalID |
| AppointmentID | INT | YES | FK, UNIQUE | - | Appointments.AppointmentID |
| Rating | INT | NO | - | - | í‰ì  (1~5) |
| Comment | NVARCHAR(500) | YES | - | - | ë¦¬ë·° ë‚´ìš© |
| CreatedAt | DATETIME | NO | - | GETDATE() | ì‘ì„± ì¼ì‹œ |

**ì¸ë±ìŠ¤**:
- PRIMARY KEY: `ReviewID`
- FOREIGN KEY: `PatientID` â†’ Users(UserID)
- FOREIGN KEY: `DoctorID` â†’ Doctors(DoctorID)
- FOREIGN KEY: `HospitalID` â†’ Hospitals(HospitalID)
- FOREIGN KEY: `AppointmentID` â†’ Appointments(AppointmentID)
- UNIQUE INDEX: `AppointmentID` (1 ì˜ˆì•½ë‹¹ 1 ë¦¬ë·°)
- INDEX: `DoctorID`, `HospitalID`

**ì œì•½ ì¡°ê±´**:
- `Rating` CHECK: `Rating BETWEEN 1 AND 5`

---

### 7. Notifications (ì•Œë¦¼ í…Œì´ë¸”)

ì‚¬ìš©ì ì•Œë¦¼ì„ ì €ì¥í•©ë‹ˆë‹¤.

| ì»¬ëŸ¼ëª… | ë°ì´í„° íƒ€ì… | NULL | í‚¤ | ê¸°ë³¸ê°’ | ì„¤ëª… |
|--------|------------|------|-----|--------|------|
| NotificationID | INT | NO | PK | IDENTITY(1,1) | ì•Œë¦¼ ê³ ìœ  ID |
| UserID | INT | NO | FK, INDEX | - | Users.UserID |
| Type | NVARCHAR(20) | NO | - | - | ì•Œë¦¼ ìœ í˜• (appointment/reminder/system/promotion) |
| Title | NVARCHAR(100) | NO | - | - | ì•Œë¦¼ ì œëª© |
| Message | NVARCHAR(255) | NO | - | - | ì•Œë¦¼ ë‚´ìš© |
| RelatedID | INT | YES | - | - | ê´€ë ¨ ID (ì˜ˆì•½ ID ë“±) |
| IsRead | BIT | NO | - | 0 | ì½ìŒ ì—¬ë¶€ |
| CreatedAt | DATETIME | NO | INDEX | GETDATE() | ìƒì„± ì¼ì‹œ |

**ì¸ë±ìŠ¤**:
- PRIMARY KEY: `NotificationID`
- FOREIGN KEY: `UserID` â†’ Users(UserID)
- INDEX: `UserID`, `CreatedAt`, `IsRead`
- COMPOSITE INDEX: `(UserID, IsRead, CreatedAt)`

---

### 8. Inquiries (ë¬¸ì˜ í…Œì´ë¸”)

ê³ ê° ë¬¸ì˜ë¥¼ ì €ì¥í•©ë‹ˆë‹¤.

| ì»¬ëŸ¼ëª… | ë°ì´í„° íƒ€ì… | NULL | í‚¤ | ê¸°ë³¸ê°’ | ì„¤ëª… |
|--------|------------|------|-----|--------|------|
| InquiryID | INT | NO | PK | IDENTITY(1,1) | ë¬¸ì˜ ê³ ìœ  ID |
| UserID | INT | YES | FK | - | Users.UserID (ë¹„íšŒì› ê°€ëŠ¥) |
| Type | NVARCHAR(20) | NO | - | - | ë¬¸ì˜ ìœ í˜• (general/reservation/technical/suggestion) |
| Name | NVARCHAR(50) | NO | - | - | ë¬¸ì˜ì ì´ë¦„ |
| Email | NVARCHAR(100) | NO | - | - | ì´ë©”ì¼ |
| Phone | NVARCHAR(20) | YES | - | - | ì „í™”ë²ˆí˜¸ |
| Subject | NVARCHAR(100) | NO | - | - | ì œëª© |
| Message | NVARCHAR(1000) | NO | - | - | ë¬¸ì˜ ë‚´ìš© |
| Status | NVARCHAR(20) | NO | - | 'pending' | ìƒíƒœ (pending/answered/closed) |
| AdminReply | NVARCHAR(1000) | YES | - | - | ê´€ë¦¬ì ë‹µë³€ |
| CreatedAt | DATETIME | NO | - | GETDATE() | ì‘ì„± ì¼ì‹œ |
| AnsweredAt | DATETIME | YES | - | - | ë‹µë³€ ì¼ì‹œ |

**ì¸ë±ìŠ¤**:
- PRIMARY KEY: `InquiryID`
- FOREIGN KEY: `UserID` â†’ Users(UserID)
- INDEX: `Status`, `CreatedAt`

---

## ì €ì¥ í”„ë¡œì‹œì €

### 1. sp_GetAvailableTimeSlots

íŠ¹ì • ì˜ì‚¬ì˜ íŠ¹ì • ë‚ ì§œ ì˜ˆì•½ ê°€ëŠ¥ ì‹œê°„ì„ ì¡°íšŒí•©ë‹ˆë‹¤.

```sql
CREATE PROCEDURE sp_GetAvailableTimeSlots
    @DoctorID INT,
    @Date DATE
AS
BEGIN
    SET NOCOUNT ON;
    
    -- ëª¨ë“  ì‹œê°„ ìŠ¬ë¡¯ (09:00 ~ 18:00, 1ì‹œê°„ ë‹¨ìœ„)
    DECLARE @AllSlots TABLE (TimeSlot TIME);
    
    INSERT INTO @AllSlots VALUES 
        ('09:00'), ('10:00'), ('11:00'), ('12:00'),
        ('13:00'), ('14:00'), ('15:00'), ('16:00'), ('17:00');
    
    -- ì´ë¯¸ ì˜ˆì•½ëœ ì‹œê°„ ì œì™¸
    SELECT TimeSlot
    FROM @AllSlots
    WHERE TimeSlot NOT IN (
        SELECT AppointmentTime
        FROM Appointments
        WHERE DoctorID = @DoctorID
          AND AppointmentDate = @Date
          AND Status IN ('pending', 'approved')
    )
    ORDER BY TimeSlot;
END
```

**ì‚¬ìš© ì˜ˆì‹œ**:
```sql
EXEC sp_GetAvailableTimeSlots @DoctorID = 1, @Date = '2025-01-15';
```

---

### 2. sp_CreateAppointment

ì˜ˆì•½ì„ ìƒì„±í•˜ê³  ì¤‘ë³µ í™•ì¸ ë° ì•Œë¦¼ì„ ìƒì„±í•©ë‹ˆë‹¤.

```sql
CREATE PROCEDURE sp_CreateAppointment
    @PatientID INT,
    @DoctorID INT,
    @AppointmentDate DATE,
    @AppointmentTime TIME,
    @Reason NVARCHAR(255),
    @AppointmentID INT OUTPUT
AS
BEGIN
    SET NOCOUNT ON;
    BEGIN TRANSACTION;
    
    BEGIN TRY
        -- 1. ì¤‘ë³µ ì˜ˆì•½ í™•ì¸
        IF EXISTS (
            SELECT 1 FROM Appointments
            WHERE DoctorID = @DoctorID
              AND AppointmentDate = @AppointmentDate
              AND AppointmentTime = @AppointmentTime
              AND Status IN ('pending', 'approved')
        )
        BEGIN
            THROW 50001, 'ì´ë¯¸ ì˜ˆì•½ëœ ì‹œê°„ì…ë‹ˆë‹¤.', 1;
        END
        
        -- 2. ì˜ˆì•½ ìƒì„±
        INSERT INTO Appointments (PatientID, DoctorID, AppointmentDate, AppointmentTime, Reason, Status)
        VALUES (@PatientID, @DoctorID, @AppointmentDate, @AppointmentTime, @Reason, 'pending');
        
        SET @AppointmentID = SCOPE_IDENTITY();
        
        -- 3. ì•Œë¦¼ ìƒì„±
        INSERT INTO Notifications (UserID, Type, Title, Message, RelatedID)
        VALUES (
            @PatientID,
            'appointment',
            'ì˜ˆì•½ì´ ì ‘ìˆ˜ë˜ì—ˆìŠµë‹ˆë‹¤',
            CONCAT('ì˜ˆì•½ ë‚ ì§œ: ', FORMAT(@AppointmentDate, 'yyyy-MM-dd'), ' ', FORMAT(@AppointmentTime, 'HH:mm')),
            @AppointmentID
        );
        
        COMMIT TRANSACTION;
    END TRY
    BEGIN CATCH
        ROLLBACK TRANSACTION;
        THROW;
    END CATCH
END
```

**ì‚¬ìš© ì˜ˆì‹œ**:
```sql
DECLARE @NewAppointmentID INT;
EXEC sp_CreateAppointment 
    @PatientID = 1, 
    @DoctorID = 1, 
    @AppointmentDate = '2025-01-15', 
    @AppointmentTime = '09:00',
    @Reason = 'ê°ê¸° ì¦ìƒ',
    @AppointmentID = @NewAppointmentID OUTPUT;
SELECT @NewAppointmentID AS AppointmentID;
```

---

### 3. sp_UpdateAppointmentStatus

ì˜ˆì•½ ìƒíƒœë¥¼ ë³€ê²½í•˜ê³  ì•Œë¦¼ì„ ìƒì„±í•©ë‹ˆë‹¤.

```sql
CREATE PROCEDURE sp_UpdateAppointmentStatus
    @AppointmentID INT,
    @NewStatus NVARCHAR(20)
AS
BEGIN
    SET NOCOUNT ON;
    BEGIN TRANSACTION;
    
    BEGIN TRY
        -- ìƒíƒœ ì—…ë°ì´íŠ¸
        UPDATE Appointments
        SET Status = @NewStatus, UpdatedAt = GETDATE()
        WHERE AppointmentID = @AppointmentID;
        
        -- í™˜ìì—ê²Œ ì•Œë¦¼
        DECLARE @PatientID INT, @Message NVARCHAR(255);
        SELECT @PatientID = PatientID FROM Appointments WHERE AppointmentID = @AppointmentID;
        
        SET @Message = CASE @NewStatus
            WHEN 'approved' THEN 'ì˜ˆì•½ì´ ìŠ¹ì¸ë˜ì—ˆìŠµë‹ˆë‹¤.'
            WHEN 'completed' THEN 'ì§„ë£Œê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.'
            WHEN 'cancelled' THEN 'ì˜ˆì•½ì´ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤.'
            ELSE 'ì˜ˆì•½ ìƒíƒœê°€ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.'
        END;
        
        INSERT INTO Notifications (UserID, Type, Title, Message, RelatedID)
        VALUES (@PatientID, 'appointment', 'ì˜ˆì•½ ìƒíƒœ ë³€ê²½', @Message, @AppointmentID);
        
        COMMIT TRANSACTION;
    END TRY
    BEGIN CATCH
        ROLLBACK TRANSACTION;
        THROW;
    END CATCH
END
```

---

## íŠ¸ë¦¬ê±°

### tr_UpdateHospitalRating

ë¦¬ë·° ì¶”ê°€/ìˆ˜ì •/ì‚­ì œ ì‹œ ë³‘ì› í‰ê·  í‰ì ì„ ìë™ìœ¼ë¡œ ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤.

```sql
CREATE TRIGGER tr_UpdateHospitalRating
ON Reviews
AFTER INSERT, UPDATE, DELETE
AS
BEGIN
    SET NOCOUNT ON;
    
    -- ì˜í–¥ë°›ì€ ë³‘ì› ID ì¶”ì¶œ
    DECLARE @HospitalIDs TABLE (HospitalID INT);
    
    INSERT INTO @HospitalIDs
    SELECT DISTINCT HospitalID FROM inserted
    UNION
    SELECT DISTINCT HospitalID FROM deleted;
    
    -- ê° ë³‘ì›ì˜ í‰ê·  í‰ì  ë° ë¦¬ë·° ìˆ˜ ì—…ë°ì´íŠ¸
    UPDATE H
    SET 
        H.Rating = ISNULL(AVG(CAST(R.Rating AS DECIMAL(3,2))), 0),
        H.ReviewCount = COUNT(R.ReviewID)
    FROM Hospitals H
    INNER JOIN @HospitalIDs HID ON H.HospitalID = HID.HospitalID
    LEFT JOIN Reviews R ON H.HospitalID = R.HospitalID
    GROUP BY H.HospitalID;
END
```

---

## ë°ì´í„°ë² ì´ìŠ¤ ë°±ì—… ë° ë³µì›

### ë°±ì—…

```sql
BACKUP DATABASE DoctorLink
TO DISK = 'C:\Backup\DoctorLink.bak'
WITH FORMAT, MEDIANAME = 'DoctorLinkBackup', NAME = 'Full Backup of DoctorLink';
```

### ë³µì›

```sql
RESTORE DATABASE DoctorLink
FROM DISK = 'C:\Backup\DoctorLink.bak'
WITH RECOVERY;
```

---

## ì„±ëŠ¥ ìµœì í™”

### ì¸ë±ìŠ¤ ìµœì í™”

- ìì£¼ ì¡°íšŒë˜ëŠ” ì»¬ëŸ¼ì— ì¸ë±ìŠ¤ ìƒì„±
- FOREIGN KEY ìë™ ì¸ë±ì‹±
- COMPOSITE INDEXë¡œ ë³µí•© ì¡°ê±´ ì¿¼ë¦¬ ìµœì í™”

### ì¿¼ë¦¬ ìµœì í™”

- WHERE ì ˆì— ì¸ë±ìŠ¤ ì»¬ëŸ¼ ì‚¬ìš©
- SELECT * ëŒ€ì‹  í•„ìš”í•œ ì»¬ëŸ¼ë§Œ ì¡°íšŒ
- JOIN ì‹œ ì¸ë±ìŠ¤ í™œìš©

### ì €ì¥ í”„ë¡œì‹œì € ì‚¬ìš©

- ë³µì¡í•œ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ DBì—ì„œ ì²˜ë¦¬
- ë„¤íŠ¸ì›Œí¬ íŠ¸ë˜í”½ ê°ì†Œ
- ì¿¼ë¦¬ ìµœì í™” ë° ì¬ì‚¬ìš©

---

## ë³´ì•ˆ

### ë¯¼ê° ì •ë³´ ë³´í˜¸

- ë¹„ë°€ë²ˆí˜¸: bcrypt í•´ì‹± (salt 10 rounds)
- ê°œì¸ì •ë³´: NVARCHAR ì•”í˜¸í™” (í–¥í›„ ê³„íš)

### SQL Injection ë°©ì–´

- Parameterized Query ì‚¬ìš©
- ì €ì¥ í”„ë¡œì‹œì € í™œìš©
- ì…ë ¥ê°’ ê²€ì¦

### ì ‘ê·¼ ì œì–´

- ì—­í•  ê¸°ë°˜ ê¶Œí•œ ê´€ë¦¬ (RBAC)
- ìµœì†Œ ê¶Œí•œ ì›ì¹™

---

## ë§ˆì´ê·¸ë ˆì´ì…˜

ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ ë³€ê²½ ì‹œ ë§ˆì´ê·¸ë ˆì´ì…˜ ìŠ¤í¬ë¦½íŠ¸ ì‘ì„±:

```sql
-- Version 1.1: AddProfileImageToUsers
ALTER TABLE Users
ADD ProfileImage NVARCHAR(255) NULL;
```

---

## ì°¸ê³  ìë£Œ

- [SQL Server ê³µì‹ ë¬¸ì„œ](https://docs.microsoft.com/sql-server)
- [ë°ì´í„°ë² ì´ìŠ¤ ì •ê·œí™”](https://ko.wikipedia.org/wiki/ë°ì´í„°ë² ì´ìŠ¤_ì •ê·œí™”)
- [ì¸ë±ìŠ¤ ì„¤ê³„ ê°€ì´ë“œ](https://docs.microsoft.com/sql/relational-databases/indexes)

